<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dynamic Interview Q&A</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-color: #39393d;
  --primary-dark: #4f46e5;
  --accent-color: #10b981;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --border-color: #e2e8f0;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),0 4px 6px -4px rgb(0 0 0 / 0.1);
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
}
*{box-sizing:border-box;}
body{
  font-family:'Inter',sans-serif;
  background: linear-gradient(135deg, #9da1b4 0%, #764ba2 100%);
  margin:0;padding:1rem;color:var(--text-primary);line-height:1.5;
}
.container{max-width:1200px;margin:0 auto;padding:0;}
.header{
  text-align:center;
  margin-bottom:1.5rem;
  background:rgba(255,255,255,0.95);
  backdrop-filter:blur(10px);
  padding:1.5rem;
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow-lg);
  border:1px solid rgba(255,255,255,0.2);
}
.header h1{
  margin:0 0 0.5rem 0;
  font-size:clamp(1.75rem,4vw,2.5rem);
  font-weight:700;
  background:linear-gradient(135deg,var(--primary-color),var(--accent-color));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.header p{color:var(--text-secondary);font-size:1.05rem;margin:0;font-weight:400;}
.loading{text-align:center;padding:2rem;color:var(--text-secondary);font-size:1rem;}
.spinner{display:inline-block;width:1.8rem;height:1.8rem;border:3px solid var(--border-color);border-radius:50%;border-top-color:var(--primary-color);animation:spin 1s linear infinite;margin-right:0.5rem;}
@keyframes spin{to{transform:rotate(360deg);}}
.error{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:0.75rem;border-radius:var(--radius-md);text-align:center;margin:0.75rem 0;}
.download-btn{
  display:block;
  margin:0.75rem 0;
  padding:0.5rem 1rem;
  background:var(--accent-color);
  color:#fff;
  border:none;
  border-radius:var(--radius-md);
  cursor:pointer;
  font-weight:600;
}

.module{margin-bottom:1rem;background:rgba(255,255,255,0.95);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-md);border:1px solid rgba(255,255,255,0.2);transition:all 0.3s;}
.module:hover{transform:translateY(-2px);box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);}

.module-header{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 1rem;background:linear-gradient(135deg,var(--primary-color),var(--primary-dark));color:#fff;font-weight:600;font-size:1rem;cursor:pointer;border-radius:var(--radius-md);}
.module-title{display:flex;align-items:center;gap:0.5rem;}
.chevron{transition:transform 0.3s;font-size:1.2rem;}
.module.active .chevron{transform:rotate(180deg);}

/* Search box with mic */
.search-box-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
  margin-top: 0.5rem;
}
.search-box-inline {
  width: 100%;
  padding: 0.35rem 2.5rem 0.35rem 0.5rem;
  font-size: 0.85rem;
  border-radius: var(--radius-md);
  border: none;
  outline: none;
  color: #1e293b;
  box-sizing: border-box;
}
.search-box-inline:focus{box-shadow:0 0 0 2px var(--accent-color);}
.mic-btn {
  position: absolute;
  top: 50%;
  right: 0.5rem;
  transform: translateY(-50%);
  border: none;
  background: none;
  cursor: pointer;
  font-size: 1rem;
  padding: 0;
}
.mic-indicator {
  position: absolute;
  top: -2px;
  right: -2px;
  width: 8px;
  height: 8px;
  background: red;
  border-radius: 50%;
  display: none;
  animation: pulse 1s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); opacity:1; }
  50% { transform: scale(1.5); opacity:0.6; }
  100% { transform: scale(1); opacity:1; }
}

.qa-container{display:none;padding:1rem;background:rgba(248,250,252,0.8);}
.module.active .qa-container{display:block;animation:slideDown 0.3s ease;}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}

.qa-item{margin:0.5rem 0;padding:1rem;background:#fff;box-shadow:var(--shadow-sm);border:1px solid var(--border-color);border-radius:var(--radius-md);cursor:pointer;position:relative;overflow:hidden;transition:all 0.3s;}
.qa-item::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--primary-color);transform:scaleY(0);transition:transform 0.3s;}
.qa-item:hover{transform:translateX(3px);box-shadow:var(--shadow-md);border-color:var(--primary-color);}
.qa-item:hover::before{transform:scaleY(1);}
.qa-item.active{background:rgba(99,102,241,0.05);border-color:var(--primary-color);}
.qa-item.active::before{transform:scaleY(1);}

.question{font-weight:600;margin-bottom:0.3rem;font-size:0.95rem;color:var(--text-primary);}
.answer{max-height:0;overflow:hidden;opacity:0;transition:all 0.3s;color:var(--text-secondary);font-size:0.9rem;line-height:1.5;}
.qa-item.active .answer{max-height:1000px;opacity:1;margin-top:0.5rem;padding-top:0.5rem;border-top:1px solid var(--border-color);}
.highlight{background:linear-gradient(135deg,#fef3c7,#fde68a);padding:0.1rem 0.2rem;border-radius:var(--radius-md);font-weight:600;color:#92400e;}
.no-results{color:var(--text-muted);font-style:italic;padding:1rem;text-align:center;background:rgba(248,250,252,0.8);border-radius:var(--radius-md);border:2px dashed var(--border-color);}
.no-results::before{content:'üîç';display:block;font-size:1.5rem;margin-bottom:0.25rem;}

@media(max-width:768px){.module-header{align-items:flex-start;gap:0.5rem;}.search-box-wrapper{width:100%;}}
@media(prefers-color-scheme:dark){
  :root{--text-primary:#f1f5f9;--text-secondary:#cbd5e1;--text-muted:#64748b;--border-color:#334155;}
  body{background:linear-gradient(135deg,#1e293b 0%,#334155 100%);}
  .header{background:rgba(30,41,59,0.95);}
  .module{background:rgba(30,41,59,0.95);}
  .qa-container{background:rgba(15,23,42,0.8);}
  .qa-item{background:rgba(51,65,85,0.8);}
  .search-box-inline{background:#1e293b;color:#f1f5f9;}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Interview Q&A by Module</h1>
    <p>Explore comprehensive interview questions organized by topics</p>
  </div>
  <button class="download-btn">Download Current Q&A JSON</button>
  <div id="loading" class="loading"><div class="spinner"></div>Loading interview questions...</div>
  <div id="error" class="error" style="display:none;">Failed to load interview questions.</div>
  <div id="modules"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const JSON_URL='https://raw.githubusercontent.com/prasadnalawade94/tech-interview-notes/main/assets/data.json';
function showLoading(){document.getElementById('loading').style.display='block';document.getElementById('error').style.display='none';document.getElementById('modules').style.display='none';}
function hideLoading(){document.getElementById('loading').style.display='none';}
function showError(){document.getElementById('error').style.display='block';document.getElementById('modules').style.display='none';}
function showModules(){document.getElementById('modules').style.display='block';}
function debounce(func,wait){let timeout;return function(...args){clearTimeout(timeout);timeout=setTimeout(()=>func(...args),wait);};}

async function loadModules(){
  showLoading();
  try{
    const response=await axios.get(JSON_URL);
    const qaModules=response.data;
    const modulesDiv=document.getElementById('modules');
    hideLoading();
    showModules();

    Object.entries(qaModules).forEach(([module,qas])=>{
      const section=document.createElement('div');section.className='module';
      section.setAttribute('draggable','true');
      section.innerHTML=`
        <div class="module-header" tabindex="0" aria-expanded="false">
          <div class="module-title"><span>${module}</span><span class="chevron">‚ñº</span></div>
        </div>
      `;

      const qaContainer=document.createElement('div');qaContainer.className='qa-container';
      qaContainer.innerHTML=`
        <div class="search-box-wrapper">
          <input type="text" class="search-box-inline" placeholder="Search..." aria-label="Search in ${module}">
          <button class="mic-btn" title="Speak"><span>üé§</span><span class="mic-indicator"></span></button>
        </div>
      `;
      const questionsContainer=document.createElement('div');
      questionsContainer.setAttribute('role','list');
      qaContainer.appendChild(questionsContainer);
      section.appendChild(qaContainer);
      modulesDiv.appendChild(section);

      qas.forEach((item,idx)=>{
        const qaDiv=document.createElement('div');qaDiv.className='qa-item';
        qaDiv.setAttribute('role','listitem');
        qaDiv.setAttribute('tabindex','0');
        qaDiv.setAttribute('aria-expanded','false');
        qaDiv.setAttribute('draggable','true');
        qaDiv.innerHTML=`<div class='question'>${idx+1}. ${item.q}</div><div class='answer' aria-hidden='true'>${item.a}</div>`;
        questionsContainer.appendChild(qaDiv);

        // QA drag
        qaDiv.addEventListener('dragstart',()=>qaDiv.classList.add('dragging'));
        qaDiv.addEventListener('dragend',()=>qaDiv.classList.remove('dragging'));
        questionsContainer.addEventListener('dragover',e=>{
          e.preventDefault();
          const dragging=questionsContainer.querySelector('.dragging');
          const afterElem=getDragAfterElementQA(questionsContainer,e.clientY);
          if(afterElem==null) questionsContainer.appendChild(dragging);
          else questionsContainer.insertBefore(dragging,afterElem);
        });
      });

      const searchBox=section.querySelector('.search-box-inline');
      const micBtn=section.querySelector('.mic-btn');
      const indicator=section.querySelector('.mic-indicator');

      const debouncedSearch=debounce((searchValue)=>{
        let anyVisible=false;
        if(searchValue.trim()!==''){
          section.classList.add('active');
          section.querySelector('.module-header').setAttribute('aria-expanded','true');
        }
        questionsContainer.querySelectorAll('.qa-item').forEach(qa=>{
          const questionDiv=qa.querySelector('.question');
          const originalText=questionDiv.textContent;
          if(originalText.toLowerCase().includes(searchValue.toLowerCase())){
            qa.style.display='block';anyVisible=true;
            if(searchValue.trim()!==''){
              const regex=new RegExp(`(${searchValue.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');
              questionDiv.innerHTML=originalText.replace(regex,'<span class="highlight">$1</span>');
            } else questionDiv.innerHTML=originalText;
          }else{qa.style.display='none';questionDiv.innerHTML=originalText;}
        });
        let noResults=section.querySelector('.no-results');
        if(!anyVisible&&searchValue.trim()!==''){
          if(!noResults){
            noResults=document.createElement('div');
            noResults.className='no-results';
            noResults.textContent='No matching questions found.';
            qaContainer.appendChild(noResults);
          }
        }else{if(noResults) noResults.remove();}
      },300);
      searchBox.addEventListener('input',e=>debouncedSearch(e.target.value));
      searchBox.addEventListener('keydown',e=>{if(e.key==='Escape'){searchBox.value='';debouncedSearch('');}});

      // Mic recognition
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(SpeechRecognition){
        const recognition = new SpeechRecognition();
        recognition.continuous=false; recognition.interimResults=true; recognition.lang='en-US';
        micBtn.addEventListener('click',()=>{
          recognition.start();
          indicator.style.display='block';
        });
        recognition.onresult=(event)=>{
          const transcript = Array.from(event.results).map(r=>r[0].transcript).join('');
          searchBox.value = transcript;
          searchBox.dispatchEvent(new Event('input'));
        };
        recognition.onend=()=>{indicator.style.display='none';};
        recognition.onerror=()=>{indicator.style.display='none';};
      }

      // Module drag
      section.addEventListener('dragstart',()=>section.classList.add('dragging'));
      section.addEventListener('dragend',()=>section.classList.remove('dragging'));
    });

    // Module drag container
    modulesDiv.addEventListener('dragover', e => {
      e.preventDefault();
      const dragging=document.querySelector('.module.dragging');
      const afterElem=getDragAfterElement(modulesDiv,e.clientY);
      if(afterElem==null) modulesDiv.appendChild(dragging);
      else modulesDiv.insertBefore(dragging,afterElem);
    });

    function getDragAfterElement(container,y){
      const draggables=[...container.querySelectorAll('.module:not(.dragging)')];
      return draggables.reduce((closest,child)=>{
        const box=child.getBoundingClientRect();
        const offset=y-box.top-box.height/2;
        if(offset<0 && offset>closest.offset) return {offset:offset,element:child}; 
        else return closest;
      },{offset:Number.NEGATIVE_INFINITY}).element;
    }
    function getDragAfterElementQA(container,y){
      const draggables=[...container.querySelectorAll('.qa-item:not(.dragging)')];
      return draggables.reduce((closest,child)=>{
        const box=child.getBoundingClientRect();
        const offset=y-box.top-box.height/2;
        if(offset<0 && offset>closest.offset) return {offset:offset,element:child}; 
        else return closest;
      },{offset:Number.NEGATIVE_INFINITY}).element;
    }

    // QA click expand/collapse + focus handling
    modulesDiv.addEventListener('click',e=>{
      const header=e.target.closest('.module-header');
      if(header){
        const currentModule=header.parentElement;
        const isActive=currentModule.classList.contains('active');
        document.querySelectorAll('.module.active').forEach(mod=>{
          if(mod!==currentModule){
            mod.classList.remove('active');
            mod.querySelector('.module-header').setAttribute('aria-expanded','false');
          }
        });
        currentModule.classList.toggle('active');
        header.setAttribute('aria-expanded',!isActive);

        // üëâ auto focus + select search box
        if(!isActive){
          const searchBox=currentModule.querySelector('.search-box-inline');
          if(searchBox){
            setTimeout(()=>{
              searchBox.focus();
              searchBox.select();
            },200);
          }
        }
        return;
      }

      // QA item toggle
      const item=e.target.closest('.qa-item');
      if(item){
        const isActive=item.classList.contains('active');
        const qaContainer=item.parentElement;
        qaContainer.querySelectorAll('.qa-item.active').forEach(el=>{
          if(el!==item){
            el.classList.remove('active');
            el.setAttribute('aria-expanded','false');
            el.querySelector('.answer').setAttribute('aria-hidden','true');
          }
        });
        item.classList.toggle('active');
        item.setAttribute('aria-expanded',!isActive);
        item.querySelector('.answer').setAttribute('aria-hidden',isActive);
      }

      // üëâ module ‡§Ü‡§§ ‡§ï‡•Å‡§†‡•á‡§π‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ù‡§æ‡§≤‡§Ç ‡§§‡§∞ search box focus (‡§´‡§ï‡•ç‡§§ search/mic ‡§∏‡•ã‡§°‡•Ç‡§®)
      const activeModule=document.querySelector('.module.active');
      if(activeModule && !e.target.closest('.search-box-wrapper')){
        const searchBox=activeModule.querySelector('.search-box-inline');
        if(searchBox){
          setTimeout(()=>searchBox.focus(),100);
        }
      }
    });

  } catch(err){hideLoading();showError();}
}

// download btn s
document.querySelector('.download-btn').addEventListener('click',async()=>{
  try{
    const res=await axios.get(JSON_URL);
    const blob=new Blob([JSON.stringify(res.data,null,2)],{type:'application/json'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='qa-modules.json';
    link.click();
    URL.revokeObjectURL(link.href);
  }catch(err){alert('Failed to download JSON');}
});

loadModules();
</script>
</body>
</html>
